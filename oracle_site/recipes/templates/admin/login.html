{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static "admin/css/login.css" %}">
  <link rel="stylesheet" href="{% static 'recipes/css/keyboard.css' %}">
  {{ form.media }}
  <style>
    /* Center buttons and make both render text identically */
    #login-form .submit-row {
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    #login-form .submit-row .button.default {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      padding: 10px 15px; /* match admin button sizing */
    }
  </style>
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script src="{% static 'recipes/js/keyboard.js' %}" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('#login-form input[type="text"], #login-form input[type="password"]').forEach(function (input) {
        input.classList.add('virtual-keyboard-target');
      });
    });
  </script>
{% endblock %}

{% block bodyclass %}{{ block.super }} login{% endblock %}
{% block usertools %}{% endblock %}
{% block nav-global %}{% endblock %}
{% block nav-sidebar %}{% endblock %}
{% block content_title %}{% endblock %}
{% block nav-breadcrumbs %}{% endblock %}

{% block content %}
  {% if form.errors and not form.non_field_errors %}
    <p class="errornote">
      {% blocktranslate count counter=form.errors.items|length %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktranslate %}
    </p>
  {% endif %}

  {% if form.non_field_errors %}
    {% for error in form.non_field_errors %}
      <p class="errornote">{{ error }}</p>
    {% endfor %}
  {% endif %}

  <div id="content-main">
    {% if user.is_authenticated %}
      <p class="errornote">
        {% blocktranslate trimmed %}
          You are authenticated as {{ username }}, but are not authorized to
          access this page. Would you like to login to a different account?
        {% endblocktranslate %}
      </p>
    {% endif %}

    <form action="{{ app_path }}" method="post" id="login-form">{% csrf_token %}
      <div class="form-row">
        {{ form.username.errors }}
        {{ form.username.label_tag }} {{ form.username }}
      </div>
      <div class="form-row">
        {{ form.password.errors }}
        {{ form.password.label_tag }} {{ form.password }}
        <input type="hidden" name="next" value="{{ next }}">
      </div>

      {% url 'admin_password_reset' as password_reset_url %}
      {% if password_reset_url %}
        <div class="password-reset-link">
          <a href="{{ password_reset_url }}">{% translate 'Forgotten your password or username?' %}</a>
        </div>
      {% endif %}

      <div class="submit-row">
        <button type="submit" class="button default">{% translate 'Log in' %}</button>
        <a href="/" class="button default">{% translate 'Back to site' %}</a>
      </div>
    </form>
  </div>
  <div id="onscreen-keyboard" class="onscreen-keyboard">
    <div id="alphabet-panel">
      <div class="keyboard-row">
        <button class="key">q</button><button class="key">w</button><button class="key">e</button><button class="key">r</button><button class="key">t</button><button class="key">y</button><button class="key">u</button><button class="key">i</button><button class="key">o</button><button class="key">p</button>
      </div>
      <div class="keyboard-row">
        <button class="key">a</button><button class="key">s</button><button class="key">d</button><button class="key">f</button><button class="key">g</button><button class="key">h</button><button class="key">j</button><button class="key">k</button><button class="key">l</button>
      </div>
      <div class="keyboard-row">
        <button class="key shift-btn">Shift</button><button class="key">z</button><button class="key">x</button><button class="key">c</button><button class="key">v</button><button class="key">b</button><button class="key">n</button><button class="key">m</button><button class="key" data-key="backspace">Backspace</button>
      </div>
      <div class="keyboard-row">
        <button class="key key-large" data-key="space">Space</button>
        <button class="key key-large" id="toggle-symbols-btn">Symbols</button>
        <button class="key key-large" data-key="hide keyboard">Hide Keyboard</button>
      </div>
    </div>
    <div id="symbols-panel" style="display: none;">
      <div class="keyboard-row">
        <button class="key">1</button><button class="key">2</button><button class="key">3</button><button class="key">4</button><button class="key">5</button><button class="key">6</button><button class="key">7</button><button class="key">8</button><button class="key">9</button><button class="key">0</button>
      </div>
      <div class="keyboard-row">
        <button class="key">-</button><button class="key">=</button><button class="key">[</button><button class="key">]</button><button class="key">\</button><button class="key">;</button><button class="key">'</button><button class="key">,</button><button class="key">.</button><button class="key">/</button><button class="key">*</button><button class="key">+</button>
      </div>
      <div class="keyboard-row">
        <button class="key">~</button><button class="key">!</button><button class="key">@</button><button class="key">#</button><button class="key">$</button><button class="key">%</button><button class="key">^</button><button class="key">&amp;</button><button class="key">*</button><button class="key">(</button><button class="key">)</button>
      </div>
      <div class="keyboard-row">
        <button class="key">_</button><button class="key">+</button><button class="key">{</button><button class="key">}</button><button class="key">|</button><button class="key">:</button><button class="key">"</button><button class="key">&lt;</button><button class="key">&gt;</button><button class="key">?</button>
      </div>
      <div class="keyboard-row">
        <button class="key" id="toggle-alphabet-btn">ABC</button>
        <button class="key key-large" data-key="hide keyboard">Hide Keyboard</button>
      </div>
    </div>
  </div>
{% endblock %}
